```python
import os
import sys
import pandas as pd
from datetime import datetime
```

## 对于待合并的数据表格的表头不正规的情况，如表头由多行组成且行中有折分单元格的情况，这种情形下，如何强行合并可能得不到想要的效果，如何做，且看如下分解：

### 第一步：先进行常规合并操作，得到不规整的合并后的的表，目得到的是内容齐全的在一个表格内的所有数据


```python
def displaydir(dir_path):
    file_list = []
    n = 0
    for filenames in os.walk(dir_path):
        for table in filenames[2]:
            path = filenames[0] + '/' + table
            li = pd.read_excel(path,header=3,dtype=str)
            li['file_name'] = os.path.splitext(table)[0]
            n += 1
            file_list.append(li)
            print(' 第' + str(n) + ' 个表格已合并')
    print('在该目录下有 %d 个 xlsx 文件' % len(file_list))
    data_result = pd.concat(file_list, ignore_index=True)
    data_result.to_excel(out_path + '/' + 'result.xlsx', index=False)


if __name__ == "__main__":
    dir_path = r"D:\1 - 副本\新建文件夹"
    out_path = r"C:\Users\win\Desktop\xlsx"
    if not os.path.exists(out_path):
        os.makedirs(out_path)

    displaydir(dir_path)
```

### 第二步：根据需要，对表头的列进行重命名操作，并且删除数据行为全空数据的行。


```python
data = pd.read_excel(r"C:\Users\win\Desktop\xlsx\result.xlsx",dtype=str)
data.rename(columns={'Unnamed: 1':'学校','Unnamed: 2':'姓名','Unnamed: 3':'学生/教师','Unnamed: 4':'性别','Unnamed: 5':'身份证号','Unnamed: 6':'手机号'},inplace=True)
data.dropna(axis=0,how='all',inplace=True)
data
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>学校</th>
      <th>姓名</th>
      <th>学生/教师</th>
      <th>性别</th>
      <th>身份证号</th>
      <th>手机号</th>
      <th>离亳时间</th>
      <th>去往地区</th>
      <th>是否中高风险地区</th>
      <th>交通工具</th>
      <th>返亳时间</th>
      <th>是否中高风险地区.1</th>
      <th>交通工具.1</th>
      <th>是否核酸检测及结果</th>
      <th>备注</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>葛春雷</td>
      <td>学生家长</td>
      <td>男</td>
      <td>341281198606085718</td>
      <td>13731822776</td>
      <td>8月1日</td>
      <td>浙江金华</td>
      <td>否</td>
      <td>自驾车</td>
      <td>未确定</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>12</th>
      <td>拂晓小学</td>
      <td>游茗泽</td>
      <td>学生</td>
      <td>男</td>
      <td>341222201106065072</td>
      <td>17756719702</td>
      <td>7月9号</td>
      <td>重庆</td>
      <td>否</td>
      <td>飞机</td>
      <td>8月4</td>
      <td>否</td>
      <td>飞机</td>
      <td>否</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>24</th>
      <td>拂晓小学</td>
      <td>鲁天皓</td>
      <td>学生</td>
      <td>男</td>
      <td>341602200810265811</td>
      <td>15955679151</td>
      <td>7月30日</td>
      <td>洛阳</td>
      <td>否</td>
      <td>高铁</td>
      <td>8月2日</td>
      <td>否</td>
      <td>高铁</td>
      <td>已检测</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>25</th>
      <td>拂晓小学</td>
      <td>颜子涵</td>
      <td>学生</td>
      <td>男</td>
      <td>341602200901237453</td>
      <td>15715673933</td>
      <td>7.2</td>
      <td>贵阳</td>
      <td>否</td>
      <td>火车</td>
      <td>8月8号</td>
      <td>否</td>
      <td>火车</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>36</th>
      <td>拂晓中心小学</td>
      <td>李盼</td>
      <td>教师</td>
      <td>女</td>
      <td>341281198812020045</td>
      <td>17756719778</td>
      <td>2021.7.11</td>
      <td>北京</td>
      <td>否</td>
      <td>私家车</td>
      <td>2021.7.17</td>
      <td>否</td>
      <td>私家车</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>48</th>
      <td>拂晓小学</td>
      <td>金雯雯</td>
      <td>学生</td>
      <td>女</td>
      <td>341602201312110926</td>
      <td>17681352628</td>
      <td>7月2号</td>
      <td>黎里</td>
      <td>否</td>
      <td>私车</td>
      <td>8月2号</td>
      <td>否</td>
      <td>私车</td>
      <td>否</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>60</th>
      <td>拂晓中心小学</td>
      <td>游茗泽</td>
      <td>学生</td>
      <td>男</td>
      <td>341222201106065072</td>
      <td>17756719702</td>
      <td>7月9号</td>
      <td>重庆</td>
      <td>否</td>
      <td>飞机</td>
      <td>8月4号</td>
      <td>否</td>
      <td>飞机</td>
      <td>否</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>61</th>
      <td>拂晓中心小学</td>
      <td>刘轩豪</td>
      <td>学生</td>
      <td>男</td>
      <td>341602021010180013</td>
      <td>13856855056</td>
      <td>7月10号</td>
      <td>上海</td>
      <td>否</td>
      <td>火车</td>
      <td>7月20号</td>
      <td>否</td>
      <td>火车</td>
      <td>否</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>62</th>
      <td>拂晓中心小学</td>
      <td>薛海洋</td>
      <td>学生</td>
      <td>男</td>
      <td>341602201110048378</td>
      <td>19855080218</td>
      <td>7月14号</td>
      <td>江西南昌</td>
      <td>否</td>
      <td>火车</td>
      <td>8月8</td>
      <td>否</td>
      <td>火车</td>
      <td>否</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>72</th>
      <td>NaN</td>
      <td>高浩然</td>
      <td>NaN</td>
      <td>男</td>
      <td>341621201309254119</td>
      <td>18210388933</td>
      <td>NaN</td>
      <td>北京</td>
      <td>NaN</td>
      <td>火车</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>84</th>
      <td>拂晓小学</td>
      <td>李文赞</td>
      <td>学生</td>
      <td>男</td>
      <td>341602201307108370</td>
      <td>18226052571</td>
      <td>6月28日</td>
      <td>杭州</td>
      <td>否</td>
      <td>火车</td>
      <td>8月8日</td>
      <td>否</td>
      <td>火车</td>
      <td>否</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>96</th>
      <td>北京同仁堂</td>
      <td>闫青松</td>
      <td>NaN</td>
      <td>男</td>
      <td>341281199102100037</td>
      <td>15385202325</td>
      <td>8.1号</td>
      <td>北京</td>
      <td>否</td>
      <td>私家车</td>
      <td>8.3号</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>已检测，阴性</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>108</th>
      <td>拂晓小学</td>
      <td>李雨涵</td>
      <td>学生</td>
      <td>女</td>
      <td>341602201206075821</td>
      <td>13856840045</td>
      <td>7月2日</td>
      <td>德清</td>
      <td>否</td>
      <td>火车</td>
      <td>8月10日</td>
      <td>否</td>
      <td>火车</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>109</th>
      <td>拂晓小学</td>
      <td>王文君</td>
      <td>学生</td>
      <td>女</td>
      <td>341602201210123822</td>
      <td>13225672659</td>
      <td>7月15号</td>
      <td>齐河</td>
      <td>否</td>
      <td>私家车</td>
      <td>8月4号</td>
      <td>否</td>
      <td>私家车</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>110</th>
      <td>拂晓小学</td>
      <td>宋博文</td>
      <td>学生</td>
      <td>男</td>
      <td>341602201201305819</td>
      <td>18726740423</td>
      <td>7月2日</td>
      <td>徐州</td>
      <td>否</td>
      <td>火车</td>
      <td>7月30日</td>
      <td>否</td>
      <td>私家车</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>111</th>
      <td>拂晓小学</td>
      <td>刘建豪</td>
      <td>学生</td>
      <td>男</td>
      <td>341602201108150015</td>
      <td>15895897006</td>
      <td>7月1日</td>
      <td>南京</td>
      <td>否</td>
      <td>客车</td>
      <td>末回</td>
      <td>否</td>
      <td>NaN</td>
      <td>己核酸</td>
      <td>阴性</td>
    </tr>
    <tr>
      <th>120</th>
      <td>拂晓中心小学</td>
      <td>彭宇航</td>
      <td>学生</td>
      <td>男</td>
      <td>341602201006227472</td>
      <td>17839082070</td>
      <td>7月8日</td>
      <td>湖州市</td>
      <td>否</td>
      <td>自驾</td>
      <td>暂不确定</td>
      <td>否</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>121</th>
      <td>拂晓中心小学</td>
      <td>NaN</td>
      <td>学生</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>122</th>
      <td>拂晓中心小学</td>
      <td>NaN</td>
      <td>学生</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>123</th>
      <td>拂晓中心小学</td>
      <td>石佳慧</td>
      <td>学生</td>
      <td>女</td>
      <td>341602201008275821</td>
      <td>15856737210</td>
      <td>7月3日</td>
      <td>阜阳市</td>
      <td>否</td>
      <td>自驾</td>
      <td>8月14日</td>
      <td>否</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>124</th>
      <td>拂晓中心小学</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>125</th>
      <td>佛晓中心小学</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>132</th>
      <td>拂晓中心小学</td>
      <td>王博琦</td>
      <td>学生</td>
      <td>NaN</td>
      <td>341602201402220184</td>
      <td>18956813225</td>
      <td>7.12</td>
      <td>广东潮州</td>
      <td>否</td>
      <td>火车</td>
      <td>8.9</td>
      <td>否</td>
      <td>火车</td>
      <td>是</td>
      <td>阴</td>
    </tr>
    <tr>
      <th>144</th>
      <td>拂晓小学</td>
      <td>李烨</td>
      <td>学生</td>
      <td>男</td>
      <td>341602201210180456</td>
      <td>13395676939</td>
      <td>7.27</td>
      <td>江西</td>
      <td>否</td>
      <td>高铁</td>
      <td>7.31</td>
      <td>否</td>
      <td>高铁</td>
      <td>阴</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>145</th>
      <td>拂晓中心小学</td>
      <td>王春伦</td>
      <td>老师</td>
      <td>女</td>
      <td>342126197603140992</td>
      <td>13395676939</td>
      <td>7.27</td>
      <td>江西</td>
      <td>否</td>
      <td>高铁</td>
      <td>7.31</td>
      <td>否</td>
      <td>高铁</td>
      <td>阴</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>156</th>
      <td>拂晓小学</td>
      <td>杨紫涵</td>
      <td>NaN</td>
      <td>女</td>
      <td>341602201002157462</td>
      <td>13605684781</td>
      <td>7月1日</td>
      <td>浙江台州</td>
      <td>否</td>
      <td>私家车</td>
      <td>8月5日</td>
      <td>否</td>
      <td>NaN</td>
      <td>否</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>157</th>
      <td>拂晓小学</td>
      <td>李昊燃</td>
      <td>NaN</td>
      <td>男</td>
      <td>341602200911037471</td>
      <td>18130689296</td>
      <td>6月29</td>
      <td>深圳</td>
      <td>否</td>
      <td>火车</td>
      <td>NaN</td>
      <td>否</td>
      <td>NaN</td>
      <td>否</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>168</th>
      <td>拂晓小学</td>
      <td>张济</td>
      <td>学生</td>
      <td>男</td>
      <td>341602200912260018</td>
      <td>17756802419</td>
      <td>7.19</td>
      <td>合肥</td>
      <td>否</td>
      <td>高铁</td>
      <td>7.21</td>
      <td>否</td>
      <td>火车</td>
      <td>否</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>180</th>
      <td>拂晓小学</td>
      <td>李芸茹</td>
      <td>学生</td>
      <td>女</td>
      <td>341602201006223762</td>
      <td>13399677321</td>
      <td>2021-07-14 00:00:00</td>
      <td>北京</td>
      <td>否</td>
      <td>火车</td>
      <td>2021-07-30 00:00:00</td>
      <td>否</td>
      <td>火车</td>
      <td>否</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>204</th>
      <td>拂晓小学</td>
      <td>李雨涵</td>
      <td>学生</td>
      <td>女</td>
      <td>341602201206075821</td>
      <td>13856840045</td>
      <td>7月2日</td>
      <td>德清</td>
      <td>否</td>
      <td>火车</td>
      <td>8月10日</td>
      <td>否</td>
      <td>火车</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>216</th>
      <td>拂晓中心小学</td>
      <td>邓佳丽</td>
      <td>教师</td>
      <td>女</td>
      <td>341022199009051129</td>
      <td>15385250868</td>
      <td>2021-07-29 00:00:00</td>
      <td>黄山</td>
      <td>否</td>
      <td>私家车</td>
      <td>2021-08-06 00:00:00</td>
      <td>否</td>
      <td>私家车</td>
      <td>否</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>228</th>
      <td>亳州市拂晓中心小学</td>
      <td>丁宁</td>
      <td>学生</td>
      <td>女</td>
      <td>34160220080824814x</td>
      <td>15385212169</td>
      <td>7月5号</td>
      <td>江苏南京六合区</td>
      <td>低</td>
      <td>高铁</td>
      <td>八月七号</td>
      <td>低</td>
      <td>私家车</td>
      <td>是（阴性）</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>240</th>
      <td>拂晓中心小学</td>
      <td>倪淑娟</td>
      <td>教师</td>
      <td>女</td>
      <td>341602199101218603</td>
      <td>13731819512</td>
      <td>7月16</td>
      <td>郑州</td>
      <td>是</td>
      <td>火车</td>
      <td>7月17</td>
      <td>否</td>
      <td>火车</td>
      <td>是</td>
      <td>阴</td>
    </tr>
    <tr>
      <th>252</th>
      <td>拂晓中心小学</td>
      <td>彭宇航</td>
      <td>学生</td>
      <td>男</td>
      <td>341602201006227472</td>
      <td>17839082070</td>
      <td>7月8日</td>
      <td>湖州市</td>
      <td>否</td>
      <td>自驾</td>
      <td>暂不确定</td>
      <td>否</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>264</th>
      <td>拂晓小学</td>
      <td>邢紫涵</td>
      <td>学生</td>
      <td>女</td>
      <td>341602201308238388</td>
      <td>15055812502</td>
      <td>6月27号</td>
      <td>山东临沂</td>
      <td>否</td>
      <td>自驾车</td>
      <td>8月4号</td>
      <td>否</td>
      <td>自驾车</td>
      <td>阴</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>276</th>
      <td>拂晓中学小学</td>
      <td>程翠</td>
      <td>教师</td>
      <td>女</td>
      <td>341202198811273723</td>
      <td>15755866187</td>
      <td>2021-07-01 00:00:00</td>
      <td>阜阳</td>
      <td>否</td>
      <td>私家车</td>
      <td>未定</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>288</th>
      <td>拂晓中心小学</td>
      <td>李皓宇</td>
      <td>李皓宇</td>
      <td>男</td>
      <td>341602201003096892</td>
      <td>18156759877</td>
      <td>7月12</td>
      <td>云南</td>
      <td>否</td>
      <td>火车</td>
      <td>8月12</td>
      <td>否</td>
      <td>火车</td>
      <td>往返均做</td>
      <td>阴性</td>
    </tr>
    <tr>
      <th>300</th>
      <td>佛晓小学</td>
      <td>锁立婷</td>
      <td>刘老师</td>
      <td>女</td>
      <td>341621201004222941</td>
      <td>13439425476</td>
      <td>6月27</td>
      <td>北京</td>
      <td>否</td>
      <td>火车</td>
      <td>最近</td>
      <td>否</td>
      <td>私家车</td>
      <td>是</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>324</th>
      <td>拂晓小学</td>
      <td>李欣聪</td>
      <td>学生</td>
      <td>女</td>
      <td>341602201205096903</td>
      <td>15055063567</td>
      <td>2021年7月14日</td>
      <td>北京通州区</td>
      <td>否</td>
      <td>自驾</td>
      <td>2021年8月5日</td>
      <td>否</td>
      <td>火车</td>
      <td>否</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>



## reset_index () 重置索引列

pandas 中的 reset_index ()

数据清洗时，会将带空值的行删除，此时 DataFrame 或 Series 类型的数据不再是连续的索引，可以使用 reset_index () 重置索引

eg:
import pandas as pd

import numpy as np

df = pd.DataFrame(np.arange(20).reshape(5,4),index=[1,3,4,6,8])

print(df)

reset_index () 重置索引：

print(df.reset_index())

在获得新的 index，原来的 index 变成数据列，保留下来。

不想保留原来的 index，使用参数 drop=True，默认 False。

print(df.reset_index(drop=True))


```python
data.reset_index(drop=True)
data
```


```python
data.to_excel(r'D:\finall.xlsx',index=False)   # 保存工作表
```

# 上述为一个处理的完整过程


# 以下为第一学习操作的过程：



```python
file_path=r"D:\1 - 副本\新建文件夹"
file_list=os.listdir(file_path)

data_list=[]
for i in file_list:
    full_path=os.path.join(file_path,i)
    data=pd.read_excel(full_path,header=3,dtype=str)
    data_list.append(data)
    df_all=pd.concat(data_list)



# df_all.to_excel(r'D:\result1.xlsx')

```


```python
df_all.rename(columns={'Unnamed: 0':'id','Unnamed: 1':'学校','Unnamed: 2':'姓名','Unnamed: 3':'学生家长','Unnamed: 4':'性别','Unnamed: 5':'身份证号','Unnamed: 6':'手机号'},inplace=True)
# df_all.head(20)
# df_all.drop(columns=['id'], inplace=True)
df_all.head(20)
```


    ---------------------------------------------------------------------------

    NameError                                 Traceback (most recent call last)

    <ipython-input-1-241a3cfa2496> in <module>
    ----> 1 df_all.rename(columns={'Unnamed: 0':'id','Unnamed: 1':'学校','Unnamed: 2':'姓名','Unnamed: 3':'学生家长','Unnamed: 4':'性别','Unnamed: 5':'身份证号','Unnamed: 6':'手机号'},inplace=True)
          2 # df_all.head(20)
          3 # df_all.drop(columns=['id'], inplace=True)
          4 # df_all.head(20)
    

    NameError: name 'df_all' is not defined



```python
df_all.dropna(axis=0, how='all')
```


```python
data.shape
```




    (39, 15)




```python
data.reset_index(drop=True)
```


```python
data.to_excel(r'D:\finall.xlsx',index=False)
```


```python
df_all.rename(columns={'学生家长':'学生/教师'},inplace=True)
```


```python
df_all
```


```python
df_all.dropna(axis=0,how='all',inplace=True)
df_all
```


    ---------------------------------------------------------------------------

    NameError                                 Traceback (most recent call last)

    <ipython-input-5-76168dd67b61> in <module>
    ----> 1 df_all.dropna(axis=0,how='all',inplace=True)
          2 df_all
    

    NameError: name 'df_all' is not defined



```python

```
